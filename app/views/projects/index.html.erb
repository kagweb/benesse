<h2>
  <%= t 'view.home.project_list' %>
  <small>
    <%= Date.new @date.year, @date.month, 1 %> ~
    <%= Date.new @date.year, @date.month, -1 %>
  </small>
</h2>

<form class="form-inline" method="GET">
  <input type="hidden" name="date" value="<%= @date %>">
  <select class="input-medium" name="server">
    <option></option>
    <% Benesse::Application.config.servers.each do |s| %>
    <option value="<%= s %>" <%= params[:server].present? and params[:server] == s ? 'selected' : '' %>><%= s %></option>
    <% end %>
  </select>
  <button type="submit" class="btn">検索</button>
</form>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th class="center"><%= t 'view.project.progress'%></th>
      <th class="center"><%= t 'activerecord.attributes.project.promoter' %></th>
      <th class="center"><%= t 'activerecord.attributes.project.test_upload_at' %></th>
      <th class="center"><%= t 'activerecord.attributes.project.production_upload_at' %></th>
      <th class="center"><%= t 'view.utility.comment' %></th>
      <th></th>
    <tr>
  </thead>
  <tbody>

  <% @projects.each do |project| %>
    <tr>
      <td>
        <%= project.name %><br>
        <small>[<%= project_number project %>]</small><br>
      </td>
      <td class="center">
        <% if project.confirmed %>
          <span class="label label-success"><%= t 'view.utility.confirm.ok' %></span><br>
        <% else%>
          <span class="label label-warning"><%= t 'view.utility.confirm.ng' %></span><br>
        <% end %>

        <% if project.registration_status %>
          <span class="label label-success"><%= t 'view.utility.registration.production' %></span><br>
        <% else %>
          <span class="label label-warning"><%= t 'view.utility.registration.temporary' %></span><br>
        <% end %>

        <% if project.year_migrate %>
          <span class="label label-info"><%= t 'view.project.transition' %></span><br>
        <% end %>

        <% if project.server_update %>
          <span class="label label-info"><%= t 'view.project.server_update' %></span><br>
        <% end %>

        <% if project.exists_test_server %>
          <span class="label label-info"><%= t 'view.project.exists_test_server' %></span><br>
        <% end %>
      </td>
      <td class="center">
        <% if project.status == 7 %>
          <span class="label label-important">Closed</span>
        <% else %>
          <%= t 'view.project.' + status_slug(project.status) %><br>
          <%= t 'view.project.status.'  + (now_status project, status_slug(project.status)) %>
        <% end %>
      </td>
      <td class="center"><%= project.promoter.name %></td>
      <td class="center"><%= l(project.test_upload_at, format: :date) %></td>
      <td class="center"><%= l(project.production_upload_at, format: project.register_datetime ? :short : :long) %></td>
      <td class="span4"><%= truncate project.comments.last.try(:comment) || '' %></td>
      <td class="center"><%= link_to '個票', project %></td>
    </tr>
  <% end %>

  </tbody>
<table>

<%= link_to '< Prev month', { date: @date << 1 } %>
<%= link_to 'Next month >', { date: @date >> 1 }, { class: 'pull-right' } %>
